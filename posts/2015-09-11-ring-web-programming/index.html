<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>(fn[] &quot;less is more&quot;): Ring으로 웹프로그래밍</title>
    <link rel="canonical" href="http://clonekim.github.io/posts/2015-09-11-ring-web-programming/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='http://fonts.googleapis.com/css?family=Alegreya:400italic,700italic,400,700' rel='stylesheet'
          type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/default.min.css">
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">(fn[] &quot;less is more&quot;)</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li ><a href="/">Home</a></li>
                <li
                ><a href="/archives/">Archives</a></li>
                
                <li
                >
                <a href="/pages/about/">About</a>
                </li>
                
                <li><a href="/feed.xml">RSS</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">


    <div class="row">
        <div class="col-lg-9">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">2015년 9월 11일 (금)</div>
        
    </div>
    <h2>Ring으로 웹프로그래밍</h2>
</div>
<div>
    <ol class="content"><li><a href="#hello-ring_프로젝트_작성">Hello-Ring 프로젝트 작성</a></li><li><a href="#middleware">MiddleWare</a></li><ol><li><a href="#ring-json">ring-json</a></li></ol><li><a href="#routing">Routing</a></li><ol><li><a href="#compojure">Compojure</a></li><li><a href="#page_not_found">Page Not Found</a></li></ol><li><a href="#미들웨어를_적용한_소스">미들웨어를 적용한 소스</a></li><li><a href="#hiccup">Hiccup</a></li><li><a href="#jade">Jade</a></li><li><a href="#http-kit">Http-kit</a></li><li><a href="#plugins">Plugins</a></li><ol><li><a href="#lein-ring">lein-ring</a></li></ol><li><a href="#참고">참고</a></li></ol>
       <h2 id="hello-ring&#95;프로젝트&#95;작성">Hello-Ring 프로젝트 작성</h2><p><em>새로운 프로젝트를 생성한다</em>  </p><pre><code>lein new hello-ring</code></pre>   <br /><p><em>leiningen.clj</em></p><p>project.clj의 :dependencies에 임베디드 Jetty서버 추가</p><pre><code>&#91;ring/ring-jetty-adapter &quot;1.4.0&quot;&#93;
</code></pre>  <br /><p>ring-jetty-adapter는 ring-core, ring-servlet, jetty-server를 의존성으로 가지고 있다</p><pre><code>ring-core: essential functions for handling parameters, cookies and more
ring-devel: functions for developing and debugging Ring applications
ring-servlet: construct Java servlets from Ring handlers
ring-jetty-adapter: a Ring adapter that uses the Jetty webserver
</code></pre> <br /><p><em>hello_ring.core</em></p><pre><code class="clojure">&#40;ns hello-ring.core
	&#40;:use &#91;ring.adapter.jetty&#93;&#41;&#41;


&#40;defn app-handler &#91;request&#93;
   {:status 200
    :header {&quot;Content-Type&quot; &quot;text/html&quot;}
    :body &quot;Hello Ring&quot;}&#41;


&#40;defn -main &#91;&#93;
   &#40;run-jetty app-handler {:port 8080}&#41;&#41;
</code></pre><p><em>실행</em></p><p><img src="/img/clojure/ring-start.png" alt="Hello Ring" /></p><pre><code>lein run -m hello-ring.core
...
2015-09-11 16:02:19.133:INFO:oejs.Server:nREPL-worker-0: jetty-9.2.10.v20150310
2015-09-11 16:02:19.153:INFO:oejs.ServerConnector:nREPL-worker-0: Started ServerConnector@31de707e{HTTP/1.1}{0.0.0.0:8080}
2015-09-11 16:02:19.154:INFO:oejs.Server:nREPL-worker-0: Started @12408ms
</code></pre><h2 id="middleware">MiddleWare</h2><h3 id="ring-json">ring-json</h3><p><em>leiningen</em></p><pre><code>&#91;ring/ring-json &quot;0.4.0&quot;&#93;</code></pre><p><em>응답을 json으로 처리</em></p><p>요청 결과를 JSON을 보내기 위해서 일부러 Content-Type를 설정 하는 것 보다<br /> response 그런 기능을 삽입하는 것이다</p><p>ring.middleware.json의 wrap-json-response를 사용한다</p><pre><code class="clojure">&#40;ns hello-ring.core
	&#40;:use &#91;ring.adapter.jetty&#93;
         &#91;ring.middleware.json :only &#91;wrap-json-response&#93;&#93;
         &#91;ring.util.response :as response&#93;&#41;&#41;

&#40;defn app-handler &#91;request&#93;
	&#40;response {:name &quot;Hello&quot; }&#41;&#41;

&#40;def app-handler
	&#40;wrap-json-response app-handler&#41;&#41;

&#40;defn -main &#91;&#93;
	&#40;run-jetty app-handler {:port 3000}&#41;&#41;
</code></pre><p><img src="/img/clojure/json-resp.png" alt="json-resp" /></p><p><em>request를 json으로 다루기</em></p><p>body자체를 json으로 받거나 요청파라미터를 처리할 경우에<br /> ring.middleware.json 의 wrap-json-body, wrap-json-params이 필요함<br /> 반드시 Content-Type이 application/json 일 경우에만 반응함</p><pre><code>&#40;POST &quot;/confirm&quot; req
  &#40;let &#91;name &#40;get-in req &#91;:params &quot;name&quot;&#93;&#41;&#93;
  &#40;response {:desc &#40;str &quot;The name you sent to me was &quot; name&#41;}&#41;&#41;&#41;

&#40;POST &quot;/&quot; req
  &#40;println &#40;get &#40;:body req&#41; &quot;age&quot;&#41;&#41;&#41;  
</code></pre><p>curl를 이용해서 request 를 보내보자</p><pre><code class="bash">curl -H &quot;Content-Type: application/json&quot; -X POST -d '{&quot;age&quot; : 20}' http://127.0.0.1:8080
</code></pre><p>post로 json 데이터를 보낼 경우 body를 출력시<br /> PersistentArrayMap 로 나타난다<br /> <a href='https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/get'>clojure.core/get</a> 으로 값 취득한다</p><p><em>json request를 param으로 읽기</em></p><p>ring.middleware.json 의  wrap-json-params이 필요함<br /> 반드시 Content-Type이 application/json 일 경우에만 반응함</p><pre><code class="bash">curl -H &quot;Content-Type: application/json&quot; -X POST -d '{&quot;age&quot; : 20, &quot;name&quot;: &quot;kim&quot;}' http://127.0.0.1:8080/confirm
</code></pre><pre><code class="clojure">
&#40;POST &quot;/confirm&quot; {p :params}
  &#40;println p&#41;&#41; ; {age 20, name kim} 으로 출력

;위와 같음
&#40;POST &quot;/confirm&quot; {model :json-params}
   &#40;println &#40;get model &quot;name&quot;&#41;&#41;; =&gt; 20
   
;파라미터를 인자로 받음
&#40;POST &quot;/confirm&quot; &#91;name age&#93;
...

; request를 그대로 사용
&#40;POST &quot;/confirm&quot; req
  &#40;let &#91;name &#40;get-in req &#91;:params &quot;name&quot;&#93;&#41;&#93;
  &#40;response {:desc &#40;str &quot;The name you sent to me was &quot; name&#41;}&#41;&#41;&#41;
</code></pre><h2 id="routing">Routing</h2><h3 id="compojure">Compojure</h3><pre><code class="clojure">&#40;ns hello-ring.core
	&#40;:require &#91;compojure.core :refer &#91;defroutes GET&#93;&#93;
		  &#91;ring.adapter.jetty :as ring&#93;&#41;&#41;


&#40;defroutes routes
	&#40;GET &quot;/&quot; &#91;&#93; &quot;&lt;h1&gt;Compojure111&lt;/h1&gt;&quot;&#41;
	&#40;POST &quot;/login&quot; req
		&#40;let &#91;id &#40;get &#40;:params req&#41; :id&#41;
		      passwd &#40;get &#40;:params req&#41; :passwd&#41;&#93;
		&#40;str &quot;Your Id: &quot; id &quot; Password: &quot; passwd&#41;&#41;&#41;&#41;

&#40;defn -main &#91;&#93;
	&#40;ring/run-jetty #'routes {:port 8080 :join? false}&#41;&#41;
</code></pre><h3 id="page&#95;not&#95;found">Page Not Found</h3><pre><code>&#40;ns hello-ring.core
   &#40;:require &#91;compojure.core :refer :all&#93;
	     &#91;compojure.route :as route&#93;
	     &#91;ring.adapter.jetty :as ring&#93;&#41;&#41;

...
&#40;defroutes app
  &#40;GET &quot;/&quot; &#91;&#93; &#40;index&#41;&#41;
  &#40;route/not-found &quot;&lt;h1&gt;Page not found&lt;/h1&gt;&quot;&#41;&#41;

&#40;defn -main &#91;&#93;
  &#40;ring/run-jetty #'app {:port 8080 :join? false}&#41;&#41;
</code></pre><h2 id="미들웨어를&#95;적용한&#95;소스">미들웨어를 적용한 소스</h2><pre><code>&#40;ns hello-ring.core
	&#40;:use
		&#91;ring.util.response :as response&#93;&#41;
		
	&#40;:require
		&#91;compojure.core :refer :all&#93;
		&#91;compojure.route :as route&#93;
		&#91;ring.middleware.json :refer &#91;wrap-json-response wrap-json-body wrap-json-params&#93;&#93;
		&#91;ring.middleware.defaults :refer &#91;wrap-defaults site-defaults&#93;&#93;&#41;&#41;
	
&#40;defroutes app-routes
	&#40;GET &quot;/&quot; &#91;&#93; &#40;str &quot;Hello &quot; &quot;Clojure&quot;&#41;&#41;
	&#40;GET &quot;/what-my-ip&quot; req &#40;response {:name &quot;Hello&quot; :ip &#40;:remote-addr req&#41;}&#41;&#41;
	&#40;POST &quot;/login&quot; req 
	   &#40;let &#91;id &#40;get &#40;:params req&#41; :id&#41;
	         passwd &#40;get &#40;:params req&#41; :passwd&#41;&#93;	          
	      &#40;response {:id id :passwd passwd}&#41;&#41;&#41;
	      
	&#40;POST &quot;/confirm&quot; req
		let &#91;name &#40;get-in req &#91;:params &quot;name&quot;&#93;&#41;&#93;
		&#40;response {:desc &#40;str &quot;The name you sent to me was &quot; name&#41;}&#41;&#41;		
	&#40;route/not-found &quot;Page not found&quot;&#41;&#41;


&#40;def app-routes
	&#40;-&gt; app-routes		
	  &#40;wrap-json-body {:keywords? true :bigdecimals? true}&#41;
		wrap-json-params
		wrap-json-response&#41;&#41;

&#40;def app
	&#40;wrap-defaults app-routes &#40;assoc-in site-defaults &#91;:security :anti-forgery&#93; false&#41;&#41;&#41;
</code></pre><h2 id="hiccup">Hiccup</h2><p><em>leiningen</em></p><pre><code>&#91;hiccup &quot;1.0.5&quot;&#93;</code></pre><p><em>repl에서 바로 테스트</em></p><pre><code class="clojure">&#40;require '&#91;hiccup.core :as h&#93;&#41;
&#40;h/html &#91;:h1 &quot;Hello World&quot;&#93;&#41;
;; &lt;h1&gt;Hello World&lt;/h1&gt;&quot;
</code></pre><p><em>ring에서 사용해보자</em></p><pre><code class="clojure">&#40;ns hello-ring.core
   &#40;:require &#91;compojure.core :refer &#91;defroutes GET&#93;&#93;
	     &#91;ring.adapter.jetty :refer &#91;run-jetty&#93;&#93;
	     &#91;hiccup.page :as page&#93;&#41;&#41;

&#40;defn index &#91;&#93;
   &#40;page/html5
	&#91;:head
	   &#91;:title &quot;Hiccup test&quot;&#93;&#93;
	&#91;:body
	   &#91;:div {:id &quot;content&quot;} &quot;Hello World&quot;&#93;&#93; &#41;&#41;

	
&#40;defroutes routes
   &#40;GET &quot;/&quot; &#91;&#93; &#40;index&#41;&#41;&#41;

&#40;def -main &#91;&#93;
   &#40;run-jetty #'routes {:port 8080}&#41;   
</code></pre><p>실제 html소스에서 공백이 제외된다</p><p><img src="/img/clojure/hiccup-html-source.png" alt="Hiccup Source" /></p><h2 id="jade">Jade</h2><p><a href='https://github.com/neuland/jade4j'>jade4</a>를 wrapper한 jade 뷰템플릿이다</p><p><em>leiningen</em></p><pre><code class="clojure">&#91;clj-jade &quot;0.1.7&quot;&#93;
</code></pre><p><em>jade_config.clj</em></p><pre><code class="clojure">&#40;ns hello-ring.jade-config
  &#40;:require
    &#91;clj-jade.core :as jade&#93;
    &#91;clojure.java.io :as io&#93;&#41;&#41;


&#40;jade/configure {:template-dir &quot;public&quot;
                 :pretty-print false
                 :cache? true}&#41;

</code></pre><p><em>core.clj</em></p><pre><code class="clojure">&#40;ns hello-ring.core

  &#40;:use 
    &#91;hello-ring.jade-config&#93;&#41;

  &#40;:require
    &#91;clj-jade.core :as jade&#93;&#41;&#41;


&#40;defn index &#91;&#93;
  &#40;jade/render &quot;index.jade&quot; {:title &quot;Hello World&quot;}&#41;
</code></pre><p><em>public/index.jade</em></p><p>title값이 치환된다</p><pre><code>!!!5
html
    head
        title= #{title}
        link&#40;href=&quot;css/bootstrap.css&quot;, rel=&quot;stylesheet&quot;, type=&quot;text/css&quot;&#41;
        link&#40;href=&quot;css/font-awesome.css&quot;, rel=&quot;stylesheet&quot;, type=&quot;text/css&quot;&#41;
    body
        nav&#40;class=&quot;navbar-default&quot;&#41;
            div&#40;class=&quot;container&quot;&#41;
...             
</code></pre><h2 id="http-kit">Http-kit</h2><p><a href='http://www.http-kit.org/'>http://www.http-kit.org</a></p><p>jetty 에서 http-kit으로 변경</p><pre><code class="clojure">&#40;ns hello-ring.core 
  &#40;:require &#91;ring.adapter.jetty :refer &#91;run-server&#93;&#93;&#41;
...

&#40;defn -main &#91;&#93;
  &#40;run-server #'app {:port 8080}&#41;&#41;
</code></pre><h2 id="plugins">Plugins</h2><h3 id="lein-ring">lein-ring</h3><p>Leiningen의 Ring 작업을 편하기 하기 위한 플러그인이다<br /> 즉 서버를 구동하거나 jar, war로 디플로이하는 하는 일이다</p><p><em>project.clj</em></p><pre><code class="clojure"> :plugins &#91;&#91;lein-ring &quot;0.8.13&quot;&#93;&#93;
 :ring {:handler hello-ring.core/app} ;;시작할 수 있는 핸들러를 지정
</code></pre><p>바로 서버구동이 가능하고 기본적으로 3000 포트를 사용함<br /> 이제 서버측 코드를 수정하면 바로 적용이 된다</p><p><em>실행</em></p><pre><code>lein ring server</code></pre><h2 id="참고">참고</h2><ul><li><a href='https://github.com/ring-clojure/ring'>https://github.com/ring-clojure/ring</a></li><li><a href='https://github.com/weavejester/hiccup'>https://github.com/weavejester/hiccup</a></li><li><a href='https://github.com/revelytix/lein-ring'>https://github.com/revelytix/lein-ring</a></li><li><a href='liquidz.github.io/2011/12/practical-compojure.html'>実践(?)Compojure</a></li><li><a href='https://github.com/technomancy/shouter'>shouter</a></li></ul>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags/clojure/">clojure</a>
    
    <a href="/tags/web programming/">web programming</a>
    
</div>


    <div id="prev-next">
        
        <a href="/posts/2015-09-20-using-jquery-in-clojurescript/">&laquo; clojurescript에서 jquery사용</a>
        
        
        <a class="right" href="/posts/2015-09-11-custom-emacs-setting/">Clojure를 위한 Emacs 환경 &raquo;</a>
        
    </div>

    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = "http://clonekim.github.io/posts/2015-09-11-ring-web-programming/";
            this.page.identifier = "Ring으로 웹프로그래밍";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//clonekim-github-io.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    


</div>

            </div>
        </div>

        <div class="col-md-3">
            <div id="sidebar">
                <h3>Links</h3>
                <ul id="links">
                    <li><a href="http://cryogenweb.org/docs/home.html">Cryogen Docs</a></li>
                    <li><a href="http://carmenla.me/blog/archives">Carmen's Blog</a></li>
                    
                    <li><a href="/pages/guick-guide/">Quick Start Guide</a></li>
                    
                    <li><a href="/pages/another-page/">Another Page</a></li>
                    
                </ul>
                
                <div id="recent">
                    <h3>Recent Posts</h3>
                    <ul>
                        
                        <li><a href="/posts/2017-01-02-angular-jsonp/">Angular 1.6 사용</a></li>
                        
                        <li><a href="/posts/2016-05-07-emacs-package/">Emacs를 쓰면서</a></li>
                        
                        <li><a href="/posts/2016-03-01-docker-start/">Docker 시작하기</a></li>
                        
                        <li><a href="/posts/2016-01-19-using-gulp-react/">Gulp로 React빌드</a></li>
                        
                        <li><a href="/posts/2016-01-18-starting-clojurescript/">ClojureScript 시작하기</a></li>
                        
                    </ul>
                </div>
                
                
                <div id="tags">
                    <h3>Tags</h3>
                    <ul>
                        
                        <li><a href="/tags/svn/">svn</a></li>
                        
                        <li><a href="/tags/very fetch/">very fetch</a></li>
                        
                        <li><a href="/tags/cryogen/">cryogen</a></li>
                        
                        <li><a href="/tags/imagemagick/">imagemagick</a></li>
                        
                        <li><a href="/tags/github/">github</a></li>
                        
                        <li><a href="/tags/clojure/">clojure</a></li>
                        
                        <li><a href="/tags/redmine/">redmine</a></li>
                        
                        <li><a href="/tags/raspberry/">raspberry</a></li>
                        
                        <li><a href="/tags/oracle/">oracle</a></li>
                        
                        <li><a href="/tags/web programming/">web programming</a></li>
                        
                        <li><a href="/tags/vi/">vi</a></li>
                        
                        <li><a href="/tags/gulp/">gulp</a></li>
                        
                        <li><a href="/tags/captcha/">captcha</a></li>
                        
                        <li><a href="/tags/java/">java</a></li>
                        
                        <li><a href="/tags/wiki/">wiki</a></li>
                        
                        <li><a href="/tags/io/">io</a></li>
                        
                        <li><a href="/tags/pi/">pi</a></li>
                        
                        <li><a href="/tags/php/">php</a></li>
                        
                        <li><a href="/tags/mariadb/">mariadb</a></li>
                        
                        <li><a href="/tags/emacs/">emacs</a></li>
                        
                        <li><a href="/tags/freemarker/">freemarker</a></li>
                        
                        <li><a href="/tags/OGNL/">OGNL</a></li>
                        
                        <li><a href="/tags/nginx/">nginx</a></li>
                        
                        <li><a href="/tags/windows/">windows</a></li>
                        
                        <li><a href="/tags/ruby/">ruby</a></li>
                        
                        <li><a href="/tags/jdbc/">jdbc</a></li>
                        
                        <li><a href="/tags/docker/">docker</a></li>
                        
                        <li><a href="/tags/angular/">angular</a></li>
                        
                        <li><a href="/tags/template/">template</a></li>
                        
                        <li><a href="/tags/jruby/">jruby</a></li>
                        
                        <li><a href="/tags/concurrent/">concurrent</a></li>
                        
                        <li><a href="/tags/angularjs/">angularjs</a></li>
                        
                        <li><a href="/tags/javascript/">javascript</a></li>
                        
                        <li><a href="/tags/microframework/">microframework</a></li>
                        
                        <li><a href="/tags/proxy/">proxy</a></li>
                        
                        <li><a href="/tags/not fetch/">not fetch</a></li>
                        
                        <li><a href="/tags/game/">game</a></li>
                        
                        <li><a href="/tags/node.js/">node.js</a></li>
                        
                        <li><a href="/tags/react/">react</a></li>
                        
                        <li><a href="/tags/taglib/">taglib</a></li>
                        
                        <li><a href="/tags/clojurescript/">clojurescript</a></li>
                        
                        <li><a href="/tags/jsp/">jsp</a></li>
                        
                    </ul>
                </div>
                
            </div>
        </div>
    </div>
    <footer>Copyright &copy; 2017 DAEHEE KIM
        <p style="text-align: center;">Powered by <a href="http://cryogenweb.org">Cryogen</a></p></footer>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="/js/highlight.pack.js" type="text/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>
 <link rel="stylesheet" type="text/css" href=nil>
<script>
window.klipse_settings = null;
</script>
<script src=nil></script> 

</body>
</html>
