<!DOCTYPE html>
<html><head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    
    <meta name="author" content="DAEHEE KIM"/>

    
    <meta name="description" content="PHP Install apt-get install php5-fpm php5-mongo php5-mysql  /etc/php5/fpm/php.ini
; This directive determines whether or not PHP will recognize code between ; &amp;lt;? and ?&amp;gt; tags as PHP source which should be processed as such. It is ; generally recommended that &amp;lt;?php and ?&amp;gt; should be used and that this feature ; should be disabled, as enabling it may result in issues when generating XML ; documents, however this remains supported for backward compatibility reasons."/>
    

    

    
    <link rel="canonical" href="http://clonekim.github.io/posts/2013/2013-05-13-phpfpm-nginx/"/>

    

    
    
    
        
            
        
    
    <title> PHP FPM | (Less is more) </title>

    <link rel="shortcut icon" href="http://clonekim.github.io/favicon.jpg"/>
    <link rel="stylesheet" href="http://clonekim.github.io/css/bulma.min.css"/>
    <link rel="stylesheet" href="http://clonekim.github.io/css/style.css"/>
</head>
<body><header>
    <nav class="navbar is-fixed-top has-background-black-bis" role="navigation" aria-label="main navigation">
        <div class="navbar-brand is-size-4">
            <a class="navbar-item" href="http://clonekim.github.io/">
                    (Less is more)
            </a>
            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbar-menu">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div id="navbar-menu" class="navbar-menu">
            <div class="navbar-end">
                
                    
                        <a class="navbar-item" href="/tags">태그</a>
                    
                
            </div>
            </div>
    </nav>
</header>
<main>
      <div class="container">
        <div class="columns">
          
          <div class="column">
            <div>
              <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#php-install">PHP Install</a></li>
<li><a href="#그-외-필요한-설정">그 외 필요한 설정</a></li>
<li><a href="#nginx에-fastcgi">nginx에 fastcgi</a></li>
<li><a href="#basic-인증">Basic 인증</a></li>
</ul></li>
</ul>
</nav>              
            </div>
          </div>          
          <div class="column is-9">
            <article class="post box is-radiusless">
              <div class="post-title">
                <h2 class="is-size-4">PHP FPM</h2>
              </div>
              <div class="post-meta">
                <span class="post-time">2013-05-13</span>
              </div>
              <div class="post-content content">
                

<h2 id="php-install">PHP Install</h2>

<pre><code>apt-get install php5-fpm php5-mongo php5-mysql
</code></pre>

<p><em>/etc/php5/fpm/php.ini</em></p>

<pre><code>; This directive determines whether or not PHP will recognize code between
; &lt;? and ?&gt; tags as PHP source which should be processed as such. It is
; generally recommended that &lt;?php and ?&gt; should be used and that this feature
; should be disabled, as enabling it may result in issues when generating XML
; documents, however this remains supported for backward compatibility reasons.
; Note that this directive does not control the &lt;?= shorthand tag, which can be
; used regardless of this directive.
; Default Value: On
; Development Value: Off
; Production Value: Off
; http://php.net/short-open-tag
short_open_tag = Off
...
; http://php.net/post-max-size
post_max_size = 8M

</code></pre>

<p><em>/etc/php5/fpm/pool.d/www.conf</em></p>

<pre><code>; Unix user/group of processes
; Note: The user is mandatory. If the group is not set, the default user's group
;       will be used.
user = www-data
group = www-data

listen = /var/run/php5-fpm.sock

listen.owner = www-data
listen.group = www-data

</code></pre>

<p><code>error</code></p>

<p>아래와 같이 퍼미션에러가 나면 nginx 와 php5-fpm의 권한이 일치하지 않아서이다</p>

<pre><code>2015/02/05 21:37:04 [crit] 8615#0: *3 connect() to unix:/var/run/php5-fpm.sock failed (13: Permission denied) while connecting to upstream, client: 127.0.0.1, server: localhost, request: &quot;GET /a.php HTTP/1.1&quot;, upstream: &quot;fastcgi://unix:/var/run/php5-fpm.sock:&quot;, host: &quot;127.0.0.1&quot;
</code></pre>

<h2 id="그-외-필요한-설정">그 외 필요한 설정</h2>

<pre><code>; 디폴트 문자코드
default_charset = &quot;UTF-8&quot;

; 타임존
date.timezone = &quot;Asia/Tokyo&quot;

[mbstring]
; 디폴트 언어설정
mbstring.language = Korean

; 내부문자코드
; 설정이 안됬을 경우 디폴트 문자코드가 사용됨
;mbstring.internal_encoding = EUC-KR

;HTTP 입력 문자 인코딩
;mbstring.http_input = auto

; HTTP 출력문자 인코딩

;mbstring.http_output = &quot;UTF-8&quot;
</code></pre>

<h2 id="nginx에-fastcgi">nginx에 fastcgi</h2>

<pre><code>server {
    listen       80;
    server_name  localhost;

    #charset koi8-r;
    #access_log  /var/log/nginx/log/host.access.log  main;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }


    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    location ~ \.php$ {
        root           /home/www;
        fastcgi_pass   unix:/var/run/php5-fpm.sock;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }

}

</code></pre>

<p>wordpress를 사용하는 예</p>

<p><em>/etc/nginx/conf.d/wordpress.conf</em></p>

<pre><code>server {
  listen 80;
  server_name example.com;
  root /var/www/wordpress;
  index index.php;

  location / {
    if (!-e $request_filename) {
      rewrite ^/(.+)#  /index.php?q=$1 last;
      break;
    }
  }
  
  # wp-config.php에 접속금지
  location ~* /wp-config.php {
    deny all;
  }

  location ~ \.php$ {
    fastcgi_pass 127.0.0.1:9000;
    fastcgi_param SCRIPT_FILENAME /home/wordpress$fastcgi_script_name;
    fastcgi_param PATH_INFO $fastcgi_script_name;
    include fastcgi_params;
  }
}
</code></pre>

<h2 id="basic-인증">Basic 인증</h2>

<pre><code>$ sudo htpasswd -cb /home/wordpress/.htpasswd wordpress password
</code></pre>

<pre><code>server {
  ...

  location ~* /wp-login\.php|/wp-admin/((?!admin-ajax\.php).)*$ {
    auth_basic &quot;Please enter your name and password&quot;;
    auth_basic_user_file  &quot;/home/wordpress/.htpasswd&quot;;
  }

  location ~ \.php$ {
  ...
}
</code></pre>

              </div>
              <div class="columns is-mobile post-meta">
                <div class="column is-half-desktop has-text-left is-paddingless"> 
                   
                  이전:<a href="http://clonekim.github.io/posts/2012/2012-05-23-vim-favorite-setting/"> 즐겨사용하는 VIM 설정</a>
                  
                </div>
                <div class="column is-half-desktop has-text-right is-paddingless">
                  
                  이후:<a href="http://clonekim.github.io/posts/2013/2013-06-16-java-compile-option/"> Java Compile Option</a>
                  
                </div>
                <div class="is-clearfix"></div>
              </div>
            </article>
          </div>

      </div>
    </main>    <footer class="footer">
    
        <div class="copyright has-text-centered">
            <a href="https://bulma.io">
                <img src="https://bulma.io/images/made-with-bulma.png" alt="Made with Bulma" width="128" height="24">
            </a>
            <p>© (Less is more) Power by Hugo</p>
        </div>
    </footer>
    <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', () => {
        
        const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
        
        if ($navbarBurgers.length > 0) {
            
            $navbarBurgers.forEach( el => {
                el.addEventListener('click', () => {
                
                const target = el.dataset.target;
                const $target = document.getElementById(target);
                
                el.classList.toggle('is-active');
                $target.classList.toggle('is-active');
    
                });
            });
        }
    });
    

    </script>
</body>
</html>
