<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>(fn[] &quot;less is more&quot;): Ring으로 웹프로그래밍</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='http://fonts.googleapis.com/css?family=Alegreya:400italic,700italic,400,700' rel='stylesheet'
          type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/default.min.css">
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/index.html">(fn[] &quot;less is more&quot;)</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li ><a href="/index.html">Home</a></li>
                <li
                ><a href="/archives.html">Archives</a></li>
                
                <li
                >
                <a href="/pages/about.html">About</a>
                </li>
                
                <li><a href="/feed.xml">RSS</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">


    <div class="row">
        <div class="col-lg-9">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">2015년 9월 11일 (금)</div>
        
    </div>
    <h2>Ring으로 웹프로그래밍</h2>
</div>
<div>
    <ol class="content"><li><a href="#hello-ring_프로젝트_작성">Hello-Ring 프로젝트 작성</a></li><li><a href="#middleware">MiddleWare</a></li><ol><li><a href="#ring-json">ring-json</a></li></ol><li><a href="#routing">Routing</a></li><ol><li><a href="#compojure">Compojure</a></li><li><a href="#page_not_found">Page Not Found</a></li></ol><li><a href="#미들웨어를_적용한_소스">미들웨어를 적용한 소스</a></li><li><a href="#hiccup">Hiccup</a></li><li><a href="#plugins">Plugins</a></li><ol><li><a href="#lein-ring">lein-ring</a></li></ol><li><a href="#참고">참고</a></li></ol>
       <h2><a name="hello-ring&#95;프로젝트&#95;작성"></a>Hello-Ring 프로젝트 작성</h2><p><em>새로운 프로젝트를 생성한다</em>  </p><pre><code>lein new hello-ring</code></pre>   <br /><p><em>leiningen.clj</em></p><p>project.clj의 :dependencies에 임베디드 Jetty서버 추가</p><pre><code>&#91;ring/ring-jetty-adapter &quot;1.4.0&quot;&#93;
</code></pre>  <br /><p>ring-jetty-adapter는 ring-core, ring-servlet, jetty-server를 의존성으로 가지고 있다</p><pre><code>ring-core: essential functions for handling parameters, cookies and more
ring-devel: functions for developing and debugging Ring applications
ring-servlet: construct Java servlets from Ring handlers
ring-jetty-adapter: a Ring adapter that uses the Jetty webserver
</code></pre> <br /><p><em>hello_ring.core</em></p><pre><code class="clojure">&#40;ns hello-ring.core
	&#40;:use &#91;ring.adapter.jetty&#93;&#41;&#41;


&#40;defn app-handler &#91;request&#93;
   {:status 200
    :header {&quot;Content-Type&quot; &quot;text/html&quot;}
    :body &quot;Hello Ring&quot;}&#41;


&#40;defn -main &#91;&#93;
   &#40;run-jetty app-handler {:port 8080}&#41;&#41;
</code></pre><p><em>실행</em></p><p><img src="/img/clojure/ring-start.png" alt="Hello Ring" /></p><pre><code>lein run -m hello-ring.core
...
2015-09-11 16:02:19.133:INFO:oejs.Server:nREPL-worker-0: jetty-9.2.10.v20150310
2015-09-11 16:02:19.153:INFO:oejs.ServerConnector:nREPL-worker-0: Started ServerConnector@31de707e{HTTP/1.1}{0.0.0.0:8080}
2015-09-11 16:02:19.154:INFO:oejs.Server:nREPL-worker-0: Started @12408ms
</code></pre><h2><a name="middleware"></a>MiddleWare</h2><h3><a name="ring-json"></a>ring-json</h3><p><em>leiningen</em></p><pre><code>&#91;ring/ring-json &quot;0.4.0&quot;&#93;</code></pre><p><em>wrap-json-response</em></p><p>json으로 응답한다</p><pre><code class="clojure">&#40;ns hello-ring.core
	&#40;:use &#91;ring.adapter.jetty&#93;
         &#91;ring.middleware.json :only &#91;wrap-json-response&#93;&#93;
         &#91;ring.util.response :as response&#93;&#41;&#41;

&#40;defn app-handler &#91;request&#93;
	&#40;response {:name &quot;Hello&quot; }&#41;&#41;

&#40;def app-handler
	&#40;wrap-json-response app-handler&#41;&#41;

&#40;defn -main &#91;&#93;
	&#40;run-jetty app-handler {:port 3000}&#41;&#41;
</code></pre><p><img src="/img/clojure/json-resp.png" alt="json-resp" /></p><p><em>json-body,json-params</em></p><p>body자체를 json으로 받거나 요청파라미터를 처리할 경우에<br /> ring.middleware.json 의 wrap-json-body, wrap-json-params이 필요함<br /> 반드시 Content-Type이 application/json 일 경우에만 반응함</p><pre><code>&#40;POST &quot;/confirm&quot; req
  &#40;let &#91;name &#40;get-in req &#91;:params &quot;name&quot;&#93;&#41;&#93;
  &#40;response {:desc &#40;str &quot;The name you sent to me was &quot; name&#41;}&#41;&#41;&#41;
</code></pre><h2><a name="routing"></a>Routing</h2><h3><a name="compojure"></a>Compojure</h3><pre><code class="clojure">&#40;ns hello-ring.core
	&#40;:require &#91;compojure.core :refer &#91;defroutes GET&#93;&#93;
		  &#91;ring.adapter.jetty :as ring&#93;&#41;&#41;


&#40;defroutes routes
	&#40;GET &quot;/&quot; &#91;&#93; &quot;&lt;h1&gt;Compojure111&lt;/h1&gt;&quot;&#41;
	&#40;POST &quot;/login&quot; req
		&#40;let &#91;id &#40;get &#40;:params req&#41; :id&#41;
		      passwd &#40;get &#40;:params req&#41; :passwd&#41;&#93;
		&#40;str &quot;Your Id: &quot; id &quot; Password: &quot; passwd&#41;&#41;&#41;&#41;

&#40;defn -main &#91;&#93;
	&#40;ring/run-jetty #'routes {:port 8080 :join? false}&#41;&#41;
</code></pre><h3><a name="page&#95;not&#95;found"></a>Page Not Found</h3><pre><code>&#40;ns hello-ring.core
   &#40;:require &#91;compojure.core :refer :all&#93;
	     &#91;compojure.route :as route&#93;
	     &#91;ring.adapter.jetty :as ring&#93;&#41;&#41;

...
&#40;defroutes app
  &#40;GET &quot;/&quot; &#91;&#93; &#40;index&#41;&#41;
  &#40;route/not-found &quot;&lt;h1&gt;Page not found&lt;/h1&gt;&quot;&#41;&#41;

&#40;defn -main &#91;&#93;
  &#40;ring/run-jetty #'app {:port 8080 :join? false}&#41;&#41;
</code></pre><h2><a name="미들웨어를&#95;적용한&#95;소스"></a>미들웨어를 적용한 소스</h2><pre><code>&#40;ns hello-ring.core
	&#40;:use
		&#91;ring.util.response :as response&#93;&#41;
		
	&#40;:require
		&#91;compojure.core :refer :all&#93;
		&#91;compojure.route :as route&#93;
		&#91;ring.middleware.json :refer &#91;wrap-json-response wrap-json-body wrap-json-params&#93;&#93;
		&#91;ring.middleware.defaults :refer &#91;wrap-defaults site-defaults&#93;&#93;&#41;&#41;
	
&#40;defroutes app-routes
	&#40;GET &quot;/&quot; &#91;&#93; &#40;str &quot;Hello &quot; &quot;Clojure&quot;&#41;&#41;
	&#40;GET &quot;/what-my-ip&quot; req &#40;response {:name &quot;Hello&quot; :ip &#40;:remote-addr req&#41;}&#41;&#41;
	&#40;POST &quot;/login&quot; req 
	   &#40;let &#91;id &#40;get &#40;:params req&#41; :id&#41;
	         passwd &#40;get &#40;:params req&#41; :passwd&#41;&#93;	          
	      &#40;response {:id id :passwd passwd}&#41;&#41;&#41;
	      
	&#40;POST &quot;/confirm&quot; req
		let &#91;name &#40;get-in req &#91;:params &quot;name&quot;&#93;&#41;&#93;
		&#40;response {:desc &#40;str &quot;The name you sent to me was &quot; name&#41;}&#41;&#41;		
	&#40;route/not-found &quot;Page not found&quot;&#41;&#41;


&#40;def app-routes
	&#40;-&gt; app-routes		
	  &#40;wrap-json-body {:keywords? true :bigdecimals? true}&#41;
		wrap-json-params
		wrap-json-response&#41;&#41;

&#40;def app
	&#40;wrap-defaults app-routes &#40;assoc-in site-defaults &#91;:security :anti-forgery&#93; false&#41;&#41;&#41;
</code></pre><h2><a name="hiccup"></a>Hiccup</h2><p><em>leiningen</em></p><pre><code>&#91;hiccup &quot;1.0.5&quot;&#93;</code></pre><p><em>repl에서 바로 테스트</em></p><pre><code class="clojure">&#40;require '&#91;hiccup.core :as h&#93;&#41;
&#40;h/html &#91;:h1 &quot;Hello World&quot;&#93;&#41;
;; &lt;h1&gt;Hello World&lt;/h1&gt;&quot;
</code></pre><p><em>ring에서 사용해보자</em></p><pre><code class="clojure">&#40;ns hello-ring.core
   &#40;:require &#91;compojure.core :refer &#91;defroutes GET&#93;&#93;
	     &#91;ring.adapter.jetty :refer &#91;run-jetty&#93;&#93;
	     &#91;hiccup.page :as page&#93;&#41;&#41;

&#40;defn index &#91;&#93;
   &#40;page/html5
	&#91;:head
	   &#91;:title &quot;Hiccup test&quot;&#93;&#93;
	&#91;:body
	   &#91;:div {:id &quot;content&quot;} &quot;Hello World&quot;&#93;&#93; &#41;&#41;

	
&#40;defroutes routes
   &#40;GET &quot;/&quot; &#91;&#93; &#40;index&#41;&#41;&#41;

&#40;def -main &#91;&#93;
   &#40;run-jetty #'routes {:port 8080}&#41;   
</code></pre><p>실제 html소스에서 공백이 제외된다</p><p><img src="/img/clojure/hiccup-html-source.png" alt="Hiccup Source" /></p><h2><a name="plugins"></a>Plugins</h2><h3><a name="lein-ring"></a>lein-ring</h3><p>Leiningen의 Ring 작업을 편하기 하기 위한 플러그인이다<br /> 즉 서버를 구동하거나 jar, war로 디플로이하는 하는 일이다</p><p><em>project.clj</em></p><pre><code class="clojure"> :plugins &#91;&#91;lein-ring &quot;0.8.13&quot;&#93;&#93;
 :ring {:handler hello-ring.core/app} ;;시작할 수 있는 핸들러를 지정
</code></pre><p>바로 서버구동이 가능하고 기본적으로 3000 포트를 사용함<br /> 이제 서버측 코드를 수정하면 바로 적용이 된다</p><p><em>실행</em></p><pre><code>lein ring server</code></pre><h2><a name="참고"></a>참고</h2><ul><li><a href='https://github.com/ring-clojure/ring'>https://github.com/ring-clojure/ring</a></li><li><a href='https://github.com/weavejester/hiccup'>https://github.com/weavejester/hiccup</a></li><li><a href='https://github.com/revelytix/lein-ring'>https://github.com/revelytix/lein-ring</a></li></ul>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags/clojure.html">clojure</a>
    
    <a href="/tags/web programming.html">web programming</a>
    
</div>


    <div id="prev-next">
        
        <a href="/posts/2015-09-23-freemarker-assign-tip.html">&laquo; Freemarker assign팁</a>
        
        
        <a class="right" href="/posts/2015-09-10-oracle-jdbc.html">Oracle Jdbc Url &raquo;</a>
        
    </div>

    


</div>

            </div>
        </div>

        <div class="col-md-3">
            <div id="sidebar">
                <h3>Links</h3>
                <ul id="links">
                    <li><a href="https://github.com/clonekim">My Github</a></li>
                    <li><a href="http://cryogenweb.org/docs/home.html">Cryogen Docs</a></li>
                    <li><a href="http://nakkaya.com/archives.html">Nakkaya</a></li>
                    
                    <li><a href="/pages/guick-guide.html">Quick Start Guide</a></li>
                    
                </ul>
                
                <div id="recent">
                    <h3>Recent Posts</h3>
                    <ul>
                        
                        <li><a href="/posts/2016-01-19-using-gulp-react.html">Gulp로 React빌드</a></li>
                        
                        <li><a href="/posts/2016-01-18-starting-clojurescript.html">ClojureScript 시작하기</a></li>
                        
                        <li><a href="/posts/2016-01-14-clojurescript-gaming.html">Clojure(Script)로 게임제작</a></li>
                        
                        <li><a href="/posts/2016-01-13-github-page.html">Github에 블로그제작</a></li>
                        
                        <li><a href="/posts/2015-09-25-starting-clojure.html">Clojure 시작하기</a></li>
                        
                    </ul>
                </div>
                
                
                <div id="tags">
                    <h3>Tags</h3>
                    <ul>
                        
                        <li><a href="/tags/svn.html">svn</a></li>
                        
                        <li><a href="/tags/cryogen.html">cryogen</a></li>
                        
                        <li><a href="/tags/imagemagick.html">imagemagick</a></li>
                        
                        <li><a href="/tags/github.html">github</a></li>
                        
                        <li><a href="/tags/clojure.html">clojure</a></li>
                        
                        <li><a href="/tags/redmine.html">redmine</a></li>
                        
                        <li><a href="/tags/raspberry.html">raspberry</a></li>
                        
                        <li><a href="/tags/oracle.html">oracle</a></li>
                        
                        <li><a href="/tags/web programming.html">web programming</a></li>
                        
                        <li><a href="/tags/vi.html">vi</a></li>
                        
                        <li><a href="/tags/captcha.html">captcha</a></li>
                        
                        <li><a href="/tags/java.html">java</a></li>
                        
                        <li><a href="/tags/wiki.html">wiki</a></li>
                        
                        <li><a href="/tags/io.html">io</a></li>
                        
                        <li><a href="/tags/pi.html">pi</a></li>
                        
                        <li><a href="/tags/php.html">php</a></li>
                        
                        <li><a href="/tags/mariadb.html">mariadb</a></li>
                        
                        <li><a href="/tags/freemarker.html">freemarker</a></li>
                        
                        <li><a href="/tags/OGNL.html">OGNL</a></li>
                        
                        <li><a href="/tags/nginx.html">nginx</a></li>
                        
                        <li><a href="/tags/windows.html">windows</a></li>
                        
                        <li><a href="/tags/ruby.html">ruby</a></li>
                        
                        <li><a href="/tags/jdbc.html">jdbc</a></li>
                        
                        <li><a href="/tags/template.html">template</a></li>
                        
                        <li><a href="/tags/jruby.html">jruby</a></li>
                        
                        <li><a href="/tags/concurrent.html">concurrent</a></li>
                        
                        <li><a href="/tags/angularjs.html">angularjs</a></li>
                        
                        <li><a href="/tags/javascript.html">javascript</a></li>
                        
                        <li><a href="/tags/microframework.html">microframework</a></li>
                        
                        <li><a href="/tags/proxy.html">proxy</a></li>
                        
                        <li><a href="/tags/game.html">game</a></li>
                        
                        <li><a href="/tags/node.js.html">node.js</a></li>
                        
                        <li><a href="/tags/react.html">react</a></li>
                        
                        <li><a href="/tags/taglib.html">taglib</a></li>
                        
                        <li><a href="/tags/jsp.html">jsp</a></li>
                        
                    </ul>
                </div>
                
            </div>
        </div>
    </div>
    <footer>Copyright &copy;  Daehee Kim
        <p style="text-align: center;">Powered by <a href="http://cryogenweb.org">Cryogen</a></p></footer>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="/js/highlight.pack.js" type="text/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
