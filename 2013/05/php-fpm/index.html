<!DOCTYPE html>
<html lang="ko">

<head>
<meta charset="utf-8" />
<meta name="author" content="DAEHEE KIM" />
<meta name="description" content="Personal blog." />
<meta name="keywords" content="blog, tech" />
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.26" />

<link rel="canonical" href="http://clonekim.github.io/2013/05/php-fpm/">
<base href="http://clonekim.github.io/" />
<meta property="og:title" content="PHP FPM" />
<meta property="og:description" content="PHP Install apt-get install php5-fpm php5-mongo php5-mysql  /etc/php5/fpm/php.ini
; This directive determines whether or not PHP will recognize code between ; &lt;? and ?&gt; tags as PHP source which should be processed as such. It is ; generally recommended that &lt;?php and ?&gt; should be used and that this feature ; should be disabled, as enabling it may result in issues when generating XML ; documents, however this remains supported for backward compatibility reasons." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://clonekim.github.io/2013/05/php-fpm/" />



<meta property="article:published_time" content="2013-05-13T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2013-05-13T00:00:00&#43;00:00"/>











<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="PHP FPM"/>
<meta name="twitter:description" content="PHP Install apt-get install php5-fpm php5-mongo php5-mysql  /etc/php5/fpm/php.ini
; This directive determines whether or not PHP will recognize code between ; &lt;? and ?&gt; tags as PHP source which should be processed as such. It is ; generally recommended that &lt;?php and ?&gt; should be used and that this feature ; should be disabled, as enabling it may result in issues when generating XML ; documents, however this remains supported for backward compatibility reasons."/>



<meta itemprop="name" content="PHP FPM">
<meta itemprop="description" content="PHP Install apt-get install php5-fpm php5-mongo php5-mysql  /etc/php5/fpm/php.ini
; This directive determines whether or not PHP will recognize code between ; &lt;? and ?&gt; tags as PHP source which should be processed as such. It is ; generally recommended that &lt;?php and ?&gt; should be used and that this feature ; should be disabled, as enabling it may result in issues when generating XML ; documents, however this remains supported for backward compatibility reasons.">


<meta itemprop="dateModified" content="2013-05-13T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="410">



<meta itemprop="keywords" content="php,nginx," />


<link rel="stylesheet" href="css/layout.css" />
<link rel="stylesheet" href="css/color-dark.css" />



<title>


     PHP FPM 

</title>

<script src="js/highlight.min.js"></script>
<link rel="stylesheet" href="css/tomorrow-night.min.css" />
<script>hljs.initHighlightingOnLoad();</script>

</head>


<body>
<div class="main">
<header>

<div class="header-bar">

  <nav>
    <div class="siteTitle">
      <a href="http://clonekim.github.io/">(fn [] &#34;Less is more&#34;)</a>
    </div> 

    
    
    <a class="nav-item" href="/tags/"><div class="nav-item-title">Tags</div></a>
    
    <a class="nav-item active" href="/post/"><div class="nav-item-title">Posts</div></a>
    

  </nav>
</div>

  
<div class="social-links-header">

  

  
  <a href="https://github.com/clonekim/" target="_blank"><div class="social-link">GitHub</div></a>
  

  

  

  

</div>


</header>


<article class="post">
    <h1 class="title"> PHP FPM </h1>
    <div class="content"> 

<h2 id="php-install">PHP Install</h2>

<pre><code>apt-get install php5-fpm php5-mongo php5-mysql
</code></pre>

<p><em>/etc/php5/fpm/php.ini</em></p>

<pre><code>; This directive determines whether or not PHP will recognize code between
; &lt;? and ?&gt; tags as PHP source which should be processed as such. It is
; generally recommended that &lt;?php and ?&gt; should be used and that this feature
; should be disabled, as enabling it may result in issues when generating XML
; documents, however this remains supported for backward compatibility reasons.
; Note that this directive does not control the &lt;?= shorthand tag, which can be
; used regardless of this directive.
; Default Value: On
; Development Value: Off
; Production Value: Off
; http://php.net/short-open-tag
short_open_tag = Off
...
; http://php.net/post-max-size
post_max_size = 8M

</code></pre>

<p><em>/etc/php5/fpm/pool.d/www.conf</em></p>

<pre><code>; Unix user/group of processes
; Note: The user is mandatory. If the group is not set, the default user's group
;       will be used.
user = www-data
group = www-data

listen = /var/run/php5-fpm.sock

listen.owner = www-data
listen.group = www-data

</code></pre>

<p><code>error</code></p>

<p>아래와 같이 퍼미션에러가 나면 nginx 와 php5-fpm의 권한이 일치하지 않아서이다</p>

<pre><code>2015/02/05 21:37:04 [crit] 8615#0: *3 connect() to unix:/var/run/php5-fpm.sock failed (13: Permission denied) while connecting to upstream, client: 127.0.0.1, server: localhost, request: &quot;GET /a.php HTTP/1.1&quot;, upstream: &quot;fastcgi://unix:/var/run/php5-fpm.sock:&quot;, host: &quot;127.0.0.1&quot;
</code></pre>

<h2 id="그-외-필요한-설정">그 외 필요한 설정</h2>

<pre><code>; 디폴트 문자코드
default_charset = &quot;UTF-8&quot;

; 타임존
date.timezone = &quot;Asia/Tokyo&quot;

[mbstring]
; 디폴트 언어설정
mbstring.language = Korean

; 내부문자코드
; 설정이 안됬을 경우 디폴트 문자코드가 사용됨
;mbstring.internal_encoding = EUC-KR

;HTTP 입력 문자 인코딩
;mbstring.http_input = auto

; HTTP 출력문자 인코딩

;mbstring.http_output = &quot;UTF-8&quot;
</code></pre>

<h2 id="nginx에-fastcgi">nginx에 fastcgi</h2>

<pre><code>server {
    listen       80;
    server_name  localhost;

    #charset koi8-r;
    #access_log  /var/log/nginx/log/host.access.log  main;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }


    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    location ~ \.php$ {
        root           /home/www;
        fastcgi_pass   unix:/var/run/php5-fpm.sock;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }

}

</code></pre>

<p>wordpress를 사용하는 예</p>

<p><em>/etc/nginx/conf.d/wordpress.conf</em></p>

<pre><code>server {
  listen 80;
  server_name example.com;
  root /var/www/wordpress;
  index index.php;

  location / {
    if (!-e $request_filename) {
      rewrite ^/(.+)#  /index.php?q=$1 last;
      break;
    }
  }
  
  # wp-config.php에 접속금지
  location ~* /wp-config.php {
    deny all;
  }

  location ~ \.php$ {
    fastcgi_pass 127.0.0.1:9000;
    fastcgi_param SCRIPT_FILENAME /home/wordpress$fastcgi_script_name;
    fastcgi_param PATH_INFO $fastcgi_script_name;
    include fastcgi_params;
  }
}
</code></pre>

<h2 id="basic-인증">Basic 인증</h2>

<pre><code>$ sudo htpasswd -cb /home/wordpress/.htpasswd wordpress password
</code></pre>

<pre><code>server {
  ...

  location ~* /wp-login\.php|/wp-admin/((?!admin-ajax\.php).)*$ {
    auth_basic &quot;Please enter your name and password&quot;;
    auth_basic_user_file  &quot;/home/wordpress/.htpasswd&quot;;
  }

  location ~ \.php$ {
  ...
}
</code></pre>
 </div>
    <footer class="post-footer">

  <div class="post-footer-data">
    
<div class="tags">
    
      <div class="tag">
        <a href="/tags/php">#php</a>
      </div>
    
      <div class="tag">
        <a href="/tags/nginx">#nginx</a>
      </div>
    
</div>

    <div class="date"> May 13, 2013 </div>
  </div>

</footer>


  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'clonekim-github-io';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>
  Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




</article>

  <footer>

  <div class="social-links-footer">

  

  
  <a href="https://github.com/clonekim/" target="_blank"><div class="social-link">GitHub</div></a>
  

  

  

  

  <div class="social-link">
  <a href="http://clonekim.github.io/index.xml" target="_blank">RSS</a>
  </div>

</div>


  <div class="copyright">  </div>

  <div class="poweredby">
    Powered by <a href="https://gohugo.io/">Hugo</a>.
  </div>

  </footer>

</body>
</html>

